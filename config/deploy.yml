i# config/deploy.yml
service: nybenchmark_app

# 1. Image Location
image: ghcr.io/benu/nybenchmark_app

# 2. Server IP (Your DigitalOcean Droplet)
servers:
  web:
    - 68.183.56.0

# 3. Proxy & Domain
proxy:
  ssl: true
  host: app.nybenchmark.org
  app_port: 80
  healthcheck:
    path: /up
    interval: 5

# 4. Registry Credentials
registry:
  server: ghcr.io
  username: benu
  password:
    - KAMAL_REGISTRY_PASSWORD

# 5. Environment Variables
env:
  secret:
    - RAILS_MASTER_KEY
    - POSTGRES_PASSWORD
  clear:
    DB_HOST: nybenchmark_app-db
    POSTGRES_USER: nybenchmark_app
    POSTGRES_DB: nybenchmark_app_production
    SOLID_QUEUE_IN_PUMA: true

# 6. Database Accessory (Postgres 17)
accessories:
  db:
    image: postgres:17
    host: 68.183.56.0
    port: 5432
    env:
      clear:
        POSTGRES_USER: nybenchmark_app
        POSTGRES_DB: nybenchmark_app_production
      secret:
        - POSTGRES_PASSWORD
    directories:
      - data:/var/lib/postgresql/data