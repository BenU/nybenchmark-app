<% content_for :title, "Observation Details" %>

<div class="grid">
  <hgroup>
    <h1>Observation Details</h1>
    <p>
      <%= @observation.entity.name %> • FY <%= @observation.fiscal_year %>
      <%# Added status badge here for better visibility %>
      <% if user_signed_in? %>
        <%= render "status_badge", status: @observation.verification_status %>
      <% end %>
    </p>
  </hgroup>
  <div class="text-right align-self-center">
    <% if user_signed_in? %>
      <% if @observation.provisional? %>
        <%= link_to "Verify this observation", verify_observation_path(@observation), role: "button" %>
      <% end %>
      <%= link_to "Edit", edit_observation_path(@observation), role: "button", class: "outline" %>
    <% end %>
    <%= link_to "Back", observations_path, role: "button", class: "secondary outline" %>
  </div>
</div>

<article>
  <div class="grid">
    <div>
      <strong>Metric</strong>
      <p><%= @observation.metric.label %> (<%= @observation.metric.key %>)</p>
    </div>
    <div>
      <strong>Value</strong>
      <p>
        <% if @observation.metric.expects_numeric? %>
          <%= @observation.metric.format_value(@observation.value_numeric) %>
        <% else %>
          <%= @observation.value_text %>
        <% end %>
      </p>
    </div>
  </div>

  <div class="grid">
    <div>
      <strong>Document</strong>
      <p><%= link_to @observation.document.title, @observation.document %></p>
    </div>
    <div>
      <strong>Page Reference</strong>
      <p><%= @observation.page_reference.presence || "—" %></p>
    </div>
  </div>

  <% if @observation.document&.file&.attached? %>
    <div class="grid">
      <div>
        <strong>PDF Page (Absolute Index)</strong>
        <p><%= @observation.pdf_page.presence || "—" %></p>
      </div>
      <div></div>
    </div>
  <% end %>

  <% if @observation.notes.present? %>
    <hr>
    <strong>Notes</strong>
    <p><%= @observation.notes %></p>
  <% end %>

  <footer>
    <small>Updated at: <%= @observation.updated_at.to_fs(:long) %></small>
    
    <% if user_signed_in? %>
      <div class="content-block">
        <%= button_to "Destroy Observation", @observation, method: :delete, class: "contrast outline", data: { turbo_confirm: "Are you sure?" } %>
      </div>
    <% end %>
  </footer>
</article>