<%= form_with(model: document, data: { controller: "document-source-type" }) do |form| %>
  <% if document.errors.any? %>
    <article class="flash flash--alert">
      <header><%= pluralize(document.errors.count, "error") %> prohibited this document from being saved:</header>
      <ul>
        <% document.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </article>
  <% end %>

  <div class="grid">
    <div>
      <%= form.label :entity_id, style: "display: block" %>
      <%= form.collection_select :entity_id, Entity.order(:name), :id, :name, { prompt: "Select Entity" } %>
    </div>

    <div>
      <%= form.label :doc_type, "Document Type", style: "display: block" %>
      <%= form.text_field :doc_type,
          list: "doc_type_suggestions",
          placeholder: "e.g. acfr, budget, quarterly_report" %>
      <datalist id="doc_type_suggestions">
        <% @doc_type_suggestions.each do |type| %>
          <option value="<%= type %>"><%= type.humanize %></option>
        <% end %>
      </datalist>
      <small>Select from suggestions or type a custom document type.</small>
    </div>
  </div>

  <div class="grid">
    <div>
      <%= form.label :fiscal_year, style: "display: block" %>
      <%= form.number_field :fiscal_year %>
    </div>

    <div>
      <%= form.label :title, style: "display: block" %>
      <%= form.text_field :title, placeholder: "e.g. Yonkers ACFR 2024" %>
    </div>
  </div>

  <div class="grid">
    <div>
      <%= form.label :source_type, "Source Type", style: "display: block" %>
      <%= form.select :source_type,
          Document.source_types.keys.map { |t| [t.humanize.upcase, t] },
          {},
          { data: { document_source_type_target: "select", action: "document-source-type#toggle" } } %>
      <small>PDF = downloadable document. Web = online data source (no file upload).</small>
    </div>

    <div>
      <%= form.label :source_url, "Source URL", style: "display: block" %>
      <%= form.url_field :source_url %>
      <small data-document-source-type-target="urlHint">
        <span data-hint-for="pdf">Link to where the original PDF can be downloaded.</span>
        <span data-hint-for="web" class="hidden">The webpage URL containing the data.</span>
      </small>
    </div>
  </div>

  <hr>

  <div data-document-source-type-target="fileSection">
    <%= form.label :file, "Upload PDF", style: "display: block" %>
    <%= form.file_field :file, accept: "application/pdf" %>
    <% if document.file.attached? %>
      <small>Current file: <%= document.file.filename %></small>
    <% end %>
  </div>

  <div>
    <%= form.label :notes, style: "display: block" %>
    <%= form.text_area :notes, rows: 3 %>
  </div>

  <br>

  <div>
    <%= form.submit %>
  </div>
<% end %>
