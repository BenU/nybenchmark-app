<main class="container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <hgroup style="margin-bottom: 0;">
      <h1>New York Entities</h1>
      <p>Select a local government to view financial performance and documents.</p>
    </hgroup>
    
    <div>
      <%= link_to "New Entity", new_entity_path, role: "button" %>
    </div>
  </div>

  <figure>
    <table role="grid">
      <thead>
        <tr>
          <th scope="col">
            <%= sortable_column_header(
                  column: "name",
                  label: "Name",
                  path: :entities_path,
                  current_sort: params[:sort],
                  current_direction: params[:direction]
                ) %>
          </th>
          <th scope="col">
            <%= sortable_column_header(
                  column: "kind",
                  label: "Type",
                  path: :entities_path,
                  current_sort: params[:sort],
                  current_direction: params[:direction]
                ) %>
          </th>
          <th scope="col">
            <%= sortable_column_header(
                  column: "government_structure",
                  label: "Gov. Structure",
                  path: :entities_path,
                  current_sort: params[:sort],
                  current_direction: params[:direction]
                ) %>
          </th>
          <th scope="col">Fiscal</th>
          <th scope="col">
            <%= sortable_column_header(
                  column: "documents_count",
                  label: "Docs",
                  path: :entities_path,
                  current_sort: params[:sort],
                  current_direction: params[:direction],
                  default_direction: "desc"
                ) %>
          </th>
          <th scope="col">
            <%= sortable_column_header(
                  column: "observations_count",
                  label: "Obs",
                  path: :entities_path,
                  current_sort: params[:sort],
                  current_direction: params[:direction],
                  default_direction: "desc"
                ) %>
          </th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @entities.each do |entity| %>
          <tr>
            <td><%= link_to entity.name, entity_path(entity.slug) %></td>
            <td><%= entity.kind.humanize %></td>
            <td>
              <% if entity.government_structure.present? %>
                <%= entity.government_structure.humanize %>
              <% else %>
                <mark class="missing-data">Needs research</mark>
              <% end %>
            </td>
            <td>
              <% if entity.fiscal_autonomy.present? %>
                <%= entity.fiscal_autonomy.humanize %>
                <% if entity.parent.present? %>
                  <small>(<%= link_to entity.parent.name, entity_path(entity.parent) %>)</small>
                <% end %>
              <% else %>
                <small class="muted">â€”</small>
              <% end %>
            </td>
            <td>
              <% if entity.documents_count.to_i > 0 %>
                <%= entity.documents_count %>
              <% else %>
                <small class="muted">0</small>
              <% end %>
            </td>
            <td>
              <% if entity.observations_count.to_i > 0 %>
                <%= entity.observations_count %>
              <% else %>
                <small class="muted">0</small>
              <% end %>
            </td>
            <td>
              <%= link_to "View", entity_path(entity.slug), role: "button", class: "outline" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </figure>

  <% if @pagy.pages > 1 %>
    <section>
      <%== @pagy.info_tag %>
      <%== @pagy.series_nav(aria_label: "Entity pages") %>
    </section>
  <% end %>

  <style>
    .missing-data {
      background-color: #fff3cd;
      color: #856404;
      padding: 0.1em 0.4em;
      border-radius: 3px;
      font-size: 0.85em;
    }
    .muted {
      color: #6c757d;
    }
  </style>
</main>