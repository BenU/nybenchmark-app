<%
  # Color based on account_type: green=revenue, red=expenditure, blue=balance_sheet, purple=derived
  chart_color = case account_type
                when "revenue" then "#16a34a"  # green
                when "expenditure" then "#dc2626"  # red
                when "derived" then "#8b5cf6"  # purple
                else "#2563eb"  # balance_sheet - blue
                end
  card_class = case account_type
               when "revenue" then "trend-card trend-card--revenue"
               when "expenditure" then "trend-card trend-card--expenditure"
               when "balance_sheet" then "trend-card trend-card--balance-sheet"
               when "derived" then "trend-card trend-card--derived"
               else "trend-card"
               end

  # Extend chart data to target year so non-filer gaps are visible on x-axis
  target_year = local_assigns[:latest_year]
  chart_data = extend_chart_data_to_year(info[:data], target_year)
  first_year, last_year = chart_year_range(chart_data)

  latest_value = info[:data].values.compact.last
  formatted_latest = if account_type == "derived"
                       latest_value ? "#{latest_value}%" : "—"
                     else
                       latest_value ? number_to_currency(latest_value, precision: 0) : "—"
                     end

  chart_library = {
    scales: { x: { display: false }, y: { display: false } },
    plugins: { legend: { display: false } },
    elements: { point: { radius: 0 } },
    spanGaps: false
  }
%>
<article class="<%= card_class %>">
  <header>
    <strong><%= label %></strong>
    <span class="trend-latest"><%= formatted_latest %></span>
  </header>
  <%= area_chart chart_data,
                 library: chart_library,
                 height: "80px", colors: [chart_color] %>
  <% if first_year && last_year %>
    <div class="trend-year-range">
      <span><%= first_year %></span>
      <span><%= last_year %></span>
    </div>
  <% end %>
</article>
