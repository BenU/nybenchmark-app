<%= form_with(model: entity) do |form| %>
  <% if entity.errors.any? %>
    <article class="flash flash--alert">
      <header><%= pluralize(entity.errors.count, "error") %> prohibited this entity from being saved:</header>
      <ul>
        <% entity.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </article>
  <% end %>

  <div>
    <%= form.label :name, style: "display: block" %>
    <%= form.text_field :name %>
  </div>

  <div>
    <%= form.label :slug, style: "display: block" %>
    <%= form.text_field :slug %>
  </div>

  <div>
    <%= form.label :state, style: "display: block" %>
    <%= form.select :state, ["NY"], {}, class: "form-select" %>
  </div>

  <div data-controller="entity-kind">
    <div>
      <%= form.label :kind, style: "display: block" %>
      <%= form.select :kind,
                      Entity.kinds.keys.map { |k| [k.titleize, k] },
                      {},
                      class: "form-select",
                      data: { entity_kind_target: "kindSelect", action: "change->entity-kind#kindChanged" } %>
    </div>

    <hr>

    <h3>Governance</h3>

  <div>
    <%= form.label :government_structure, style: "display: block" %>
    <%= form.select :government_structure, Entity.government_structures.keys.map { |k| [k.titleize, k] }, { include_blank: true } %>
  </div>

  <div data-controller="fiscal-autonomy">
    <div>
      <%= form.label :fiscal_autonomy, style: "display: block" %>
      <%= form.select :fiscal_autonomy,
                      Entity.fiscal_autonomies.keys.map { |k| [k.titleize, k] },
                      { include_blank: true },
                      data: { fiscal_autonomy_target: "autonomySelect", action: "change->fiscal-autonomy#autonomyChanged" } %>
    </div>

    <div data-fiscal-autonomy-target="parentField" class="<%= 'hidden' unless entity.dependent_fiscal_autonomy? %>">
      <%= form.label :parent_id, "Parent entity", style: "display: block" %>
      <%= form.select :parent_id,
                      Entity.where.not(kind: "school_district").order(:name).map { |e| ["#{e.name} (#{e.kind.titleize})", e.id] },
                      { include_blank: "Select parent entity..." } %>
      <small>Required for fiscally dependent entities (e.g., Big Five school districts)</small>
    </div>
  </div>

  <div>
    <%= form.label :icma_recognition_year, "ICMA Recognition Year", style: "display: block" %>
    <%= form.number_field :icma_recognition_year, min: 1900, max: Date.current.year %>
    <small>Year the entity was recognized by ICMA (International City/County Management Association)</small>
  </div>

  <div>
    <%= form.label :organization_note, style: "display: block" %>
    <%= form.text_area :organization_note, rows: 3, placeholder: "Additional governance notes..." %>
  </div>

    <div data-entity-kind-target="schoolFields" class="<%= 'hidden' unless entity.school_district_kind? %>">
      <hr>

      <h3>School Specifics</h3>

      <div>
        <%= form.label :school_legal_type, style: "display: block" %>
        <%= form.select :school_legal_type, Entity.school_legal_types.keys.map { |k| [k.titleize, k] }, { include_blank: true } %>
      </div>

      <div>
        <%= form.label :board_selection, style: "display: block" %>
        <%= form.select :board_selection, Entity.board_selections.keys.map { |k| [k.titleize, k] }, { include_blank: true } %>
      </div>

      <div>
        <%= form.label :executive_selection, style: "display: block" %>
        <%= form.select :executive_selection, Entity.executive_selections.keys.map { |k| [k.titleize, k] }, { include_blank: true } %>
      </div>
    </div>
  </div>

  <br>

  <div>
    <%= form.submit %>
  </div>
<% end %>